version: 2

models:
  - name: fct_sales_enriched
    description: "Weekly department sales joined with weekly signals - Grain: (store, department, week)"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [store_id, dept_id, store_date]
    columns:
      - name: store_id
        data_tests: [not_null]
      - name: dept_id
        data_tests: [not_null]
      - name: store_date
        data_tests: [not_null]

  - name: dim_store
    description: "Store-department dimension with latest store attributes - Grain: (store, department)"
    config:
      materialized: incremental
      incremental_strategy: merge
      unique_key: [store_id, dept_id]
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [store_id, dept_id]
    columns:
      - name: store_id
        data_tests: [not_null]
      - name: dept_id
        data_tests: [not_null]

  - name: dim_date
    description: "Weekly date dimension (Friday) with continuous coverage via dbt_utils.date_spine - Grain: (1 week)"
    config:
      materialized: incremental
      incremental_strategy: merge
      unique_key: [date_id]   
    columns:
      - name: date_id
        data_tests: [not_null, unique]
      - name: store_date
        data_tests: [not_null, unique]