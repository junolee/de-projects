version: 2

models:
  - name: stg_dept_sales
    description: "Staging model for weekly department sales - Grain: (store, department, week)"
    config:
      pre_hook: "{{load_csv(table_name='department_raw', path='department/')}}"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [store_id, dept_id, store_date]
    columns:
      - name: store_id
        data_tests: [not_null]
      - name: dept_id
        data_tests: [not_null]
      - name: store_date
        data_tests: [not_null]

  - name: stg_signals
    description: "Staging model for weekly signals - Grain: store, week"
    config:
      pre_hook: "{{load_csv(table_name='fact_raw', path='fact/')}}"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: [store_id, store_date]
    columns:
      - name: store_id
        data_tests: [not_null]
      - name: store_date
        data_tests: [not_null]

  - name: stg_stores
    description: "Staging model for stores with attributes (type, size) - Grain: store"
    config:
      pre_hook: "{{load_csv(table_name='stores_raw', path='stores/')}}"
    columns:
      - name: store_id
        data_tests: [unique, not_null]

sources:  
  - name: walmart
    database: walmart_db
    schema: bronze
    tables: 
      - name: dept_sales_raw
        identifier: department_raw
        description: "Weekly store department sales - Grain: store, department, week"
        data_tests:
          - dbt_utils.unique_combination_of_columns:
              arguments:
                combination_of_columns: [store, dept, date]
        columns:
          - name: store
            data_tests: [not_null]
          - name: dept
            data_tests: [not_null]
          - name: date
            data_tests: [not_null]

      - name: signals_raw
        identifier: fact_raw
        description: "Weekly signals including external drivers & markdown sales - Grain: store, week"
        data_tests:
          - dbt_utils.unique_combination_of_columns:
              arguments:
                combination_of_columns: [store, date]
        columns:
          - name: store
            data_tests: [not_null]
          - name: date
            data_tests: [not_null]

      - name: stores_raw
        description: "Store attributes including store type and size - Grain: store"
        columns:
          - name: store
            data_tests: [unique, not_null]